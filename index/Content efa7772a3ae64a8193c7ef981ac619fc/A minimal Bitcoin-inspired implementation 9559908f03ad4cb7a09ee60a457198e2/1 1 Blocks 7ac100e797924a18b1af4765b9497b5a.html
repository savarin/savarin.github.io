<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>1.1 Blocks</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
}

.simple-table-header {
	background: rgb(247, 246, 243);
	color: black;
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(145, 145, 142, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(187, 132, 108, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(215, 129, 58, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 148, 51, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(108, 155, 125, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(91, 151, 189, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(167, 130, 195, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(205, 116, 159, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(225, 111, 100, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(145, 145, 142, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(187, 132, 108, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(215, 129, 58, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 148, 51, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(108, 155, 125, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(91, 151, 189, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(167, 130, 195, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(205, 116, 159, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(225, 111, 100, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="7ac100e7-9792-4a18-b1af-4765b9497b5a" class="page sans"><header><img class="page-cover-image" src="1%201%20Blocks%207ac100e797924a18b1af4765b9497b5a/b3.jpeg" style="object-position:center 50.77%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">🧊</span></div><h1 class="page-title">1.1 Blocks</h1></header><div class="page-body"><p id="3555d5ee-474b-4273-b09b-7506a2b9f362" class="">Bitcoin is commonly thought about as a ledger of transactions. Let&#x27;s use that as a starting point.</p><p id="17e9312f-3c7e-4ac7-b2b5-6f0d3496fbd2" class="">
</p><h3 id="3e27b9a7-fe91-4bff-9746-f185da388931" class="">Headers</h3><p id="f2e92734-6039-4cf1-9b3d-b038746a22c1" class="">
</p><p id="1c0db278-5cd2-4834-a219-6ff231c27f21" class="">We group the transactions into &#x27;<strong>blocks</strong>&#x27;. Each block starts with a <strong>header</strong>, with information on the block&#x27;s contents:</p><ul id="7a83cdf9-4078-4c93-af23-fc6be3fa6eb5" class="bulleted-list"><li style="list-style-type:disc">Version: The version number in use.</li></ul><ul id="1137d598-b4b9-4963-81d6-7fd69a034319" class="bulleted-list"><li style="list-style-type:disc">Previous hash: Each block has an identifier or hash. Here the 32-byte hash from the previous block is an attribute of the header of the current block.</li></ul><ul id="fd6acb44-1d5d-4ccd-8e6b-5fa57c4667fb" class="bulleted-list"><li style="list-style-type:disc">Timestamp: Unix timestamp in seconds.</li></ul><ul id="8743e552-22bd-42b6-8ece-9d399dfb075d" class="bulleted-list"><li style="list-style-type:disc">Nonce: A number that makes the hash of the header start with zeroes.</li></ul><pre id="f9ef1d87-1386-44e1-bac7-fd4f344b1c03" class="code"><code>Hash = bytes

VERSION: int = 0

def init_header(previous_hash: Hash, timestamp: int, nonce: int) -&gt; bytes:
    &quot;&quot;&quot; &quot;&quot;&quot;
    return (
        VERSION.to_bytes(1, byteorder=&quot;big&quot;)
        + previous_hash
        + timestamp.to_bytes(4, byteorder=&quot;big&quot;)
        + nonce.to_bytes(32, byteorder=&quot;big&quot;)
    )</code></pre><p id="b9a24395-0d28-4e34-8df3-fce674292e2a" class="">
</p><p id="c35dac82-c962-483e-ad91-45d90e7e4f37" class="">We use &#x27;hash&#x27; as both a verb (to hash something) and a noun (the output of a hash function). It&#x27;s a little confusing. To help clear things up, let&#x27;s do something concrete - we solve for the nonce and create our first block.</p><p id="b422e99d-d2a8-4859-9b1f-17b8e9eaadb1" class="">
</p><p id="3f36d930-ed70-4a6f-ab51-de67fbd5ab83" class="">Since there is no previous block, the previous hash is set to zero. We choose an arbitrary timestamp and initialize the nonce to zero. The header now looks like this.</p><pre id="7aba37cd-0171-4400-a4e3-c909f1689888" class="code"><code>previous_hash = (0).to_bytes(32, byteorder=&quot;big&quot;)
timestamp = 1634700000
nonce = 0

header = init_header(previous_hash, timestamp, nonce)
print(f&quot;header:\n{header}&quot;)</code></pre><pre id="72b82cd2-0025-4de4-a529-17ef865df43b" class="code code-wrap"><code>header:
b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00ao\x8a\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</code></pre><p id="d45c3d18-9939-49d4-8b4b-1eea963181d9" class="">
</p><p id="134e0a45-b805-4635-ba17-5b3870070699" class="">We can make the header more readable by limiting each line to 16 bytes and separating each byte with a dash delimiter.</p><pre id="79dfe123-c0e8-45c6-aff9-66ffea88392a" class="code code-wrap"><code>import binascii

def prettify(b: bytes) -&gt; str:
    &quot;&quot;&quot; &quot;&quot;&quot;
    n = len(b)
    m = (n // 16) + (n % 16 &gt; 0)

    result = [
        binascii.hexlify(b[i * 16 : (i + 1) * 16], sep=&quot;-&quot;).decode()
        for i in range(m)
    ]
    return &quot;\n&quot;.join(result)

print(f&quot;header:\n{prettify(header)}&quot;)</code></pre><pre id="96c67622-4a3b-4847-a9d9-cca6bf5cf5c6" class="code code-wrap"><code>header:
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-61-6f-8a-e0-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00</code></pre><p id="44772830-ad8e-40e5-b5ec-b5974a84b0de" class="">
</p><p id="dec07605-94a1-4293-b4ab-b41948eb1c5c" class="">OK let&#x27;s hash. We use SHA-256 and hash the header twice. Even though only the header is hashed, we call it the block hash as it&#x27;s used to identify the whole block.</p><pre id="bb3c4ded-29be-4e05-a779-7e82060e85a2" class="code code-wrap"><code>import hashlib

guess = hashlib.sha256(hashlib.sha256(header).digest())
print(f&quot;block_hash:\n{prettify(guess.digest())}&quot;)</code></pre><pre id="b00a7c9b-ec0c-47f2-b012-41ab66dc78b6" class="code code-wrap"><code>block_hash:
48-9d-bd-f5-fd-58-0f-dc-0f-c3-72-54-6a-83-46-7e
10-01-71-84-09-f0-0c-96-25-90-72-7f-ba-21-cf-2a</code></pre><p id="7f38ced6-1aa2-4806-a401-4c9cda6b1ed1" class="">
</p><p id="3824dec9-e431-411e-9148-d1fbbd577d7c" class="">Let&#x27;s require the first two bytes be zero. Since each byte is represented by two hex digits, we need the first four characters in the no-delimiter string be zero.</p><pre id="1c7c8cbd-1c38-46ed-93f0-8a1fea445860" class="code code-wrap"><code>print(f&quot;block_hash - no delimiter:\n{guess.hexdigest()}\n&quot;)

is_new_block = guess.hexdigest()[:4] == &quot;0000&quot;
print(f&quot;is_new_block: {is_new_block}&quot;)</code></pre><pre id="4322c526-c7b4-4257-aafd-93d8735e7a80" class="code code-wrap"><code>block_hash - no delimiter:
489dbdf5fd580fdc0fc372546a83467e1001718409f00c962590727fba21cf2a

is_new_block: False</code></pre><p id="eb414fe7-1872-4fbd-a2ce-0580bc338391" class="">
</p><p id="f615dc4a-5630-4a05-9b9d-bd0787b16da9" class="">Now we keep incrementing the nonce until the first two bytes are zero.</p><pre id="703bb3ea-11de-4cd6-b6fa-91980802fb6f" class="code code-wrap"><code>previous_hash = (0).to_bytes(32, byteorder=&quot;big&quot;)
timestamp = 1634700000
nonce = 0

while True:
    header = init_header(previous_hash, timestamp, nonce)
    guess = hashlib.sha256(hashlib.sha256(header).digest())

    if guess.hexdigest()[:4] == &quot;0000&quot;:
        break

    nonce += 1

print(f&quot;nonce: {nonce}\n&quot;)
print(f&quot;block_hash:\n{prettify(guess.digest())}\n&quot;)
print(f&quot;header:\n{prettify(header)}&quot;)</code></pre><pre id="7b5afeae-84cf-4483-9fb1-2e6795808fe0" class="code code-wrap"><code>nonce: 70822

block_hash:
00-00-1f-f5-84-95-c3-dc-2a-1a-aa-69-eb-ca-4e-9b
3e-05-e6-3e-5a-31-9f-b7-3b-cd-cc-bc-db-ba-1e-72

header:
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-61-6f-8a-e0-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-01-14-a6</code></pre><p id="2d30632f-dd83-44a2-8923-144da1e9070e" class="">
</p><p id="bf0faaf3-aa60-428d-80b5-58dc124291f1" class="">We&#x27;ve &#x27;mined&#x27; our first block! Let&#x27;s highlight each header attribute for clarity.</p><figure id="4f97ae06-18c9-4986-a9a9-646158601bcd" class="image"><a href="1%201%20Blocks%207ac100e797924a18b1af4765b9497b5a/header_v1.jpg"><img style="width:528px" src="1%201%20Blocks%207ac100e797924a18b1af4765b9497b5a/header_v1.jpg"/></a></figure><p id="0de8ea7e-f621-4c65-8698-bcfe347e4a1c" class="">
</p><p id="1e7355e9-961c-4a6e-8d35-30363440ab2f" class="">Let&#x27;s wrap the while loop in a function, and allow for a maximum number of iterations - this will be useful in later sections.</p><pre id="6f403959-1141-44fe-95ff-fd79369efa44" class="code code-wrap"><code>from typing import Optional, Tuple
import hashlib

def run_proof_of_work(
    previous_hash: Hash,
    timestamp: int,
    nonce: int = 0,
    iterations: Optional[int] = None,
) -&gt; Tuple[bool, int, Optional[Hash], Optional[bytes]]:
    &quot;&quot;&quot;Find nonce that makes the first 4 bytes of twice-hashed header all
    zeroes. Maximum number of iterations can be specified.&quot;&quot;&quot;
    iteration_counter = 0

    while True:
        if iterations is not None and iteration_counter == iterations:
            return False, nonce, None, None

        header = init_header(previous_hash, timestamp, nonce)
        guess = hashlib.sha256(hashlib.sha256(header).digest())

        if guess.hexdigest()[:4] == &quot;0000&quot;:
            break

        nonce += 1
        iteration_counter += 1

    return True, nonce, guess.digest(), header</code></pre><p id="35e4c7cd-37f0-4b2b-b80e-77e11a4b44be" class="">
</p><h3 id="f02c61e5-1d5f-47d8-9928-3c4a1fa5a8ff" class="">Transactions</h3><p id="271044ba-9002-4ca7-993f-86ee25c75342" class="">For the time being, we restrict the transaction to the reward for mining the block. We use port numbers to signify each &#x27;account&#x27;. Since there is no sender in a reward transaction, we set the sender to be zero. In other words, (i) the first transaction in each block is the reward for the miner, and (ii) the reward transaction is signified by having sender zero.</p><pre id="f975a3e3-3eed-4dbe-84a1-47d387e36913" class="code code-wrap"><code>def init_transactions(node_port: int):
    &quot;&quot;&quot; &quot;&quot;&quot;
    sender = (0).to_bytes(2, byteorder=&quot;big&quot;)
    receiver = node_port.to_bytes(2, byteorder=&quot;big&quot;)

    transaction_counter = 1
    transactions = sender + receiver

    return transaction_counter, transactions</code></pre><p id="4009d3a5-833b-4678-b0e3-e46790871b33" class="">
</p><p id="59266ac5-77e4-4646-b728-59c2ebdfb42d" class="">We start with the first reward going to port 7000.</p><pre id="86119771-aec0-46c0-af2d-b87819c087ad" class="code code-wrap"><code>transaction_counter, transactions = init_transactions(7000)

print(f&quot;transaction_counter: {transaction_counter}\n&quot;)
print(f&quot;transactions:\n{prettify(transactions)}&quot;)</code></pre><pre id="81e7fce1-16b7-4db5-b59c-30440a14e545" class="code code-wrap"><code>transaction_counter: 1

transactions:
00-00-1b-58</code></pre><p id="2b51074a-7a40-4e8d-bbee-2b405d4aa7ea" class="">
</p><h3 id="c9fafed1-fbda-4c27-ba60-bc18380d6f33" class="">Blocks</h3><p id="d75ba3a6-dddd-46ec-8bb2-ef719e6aef33" class="">The block consists of the header and the transactions - we similarly wrap that in a function. The first byte of the block is reserved for the block size in bytes. The header size is fixed at 69 bytes i.e. 1 + 32 + 4 + 32.</p><pre id="af7a43ba-19de-4307-9187-57ce072b34b1" class="code code-wrap"><code>HEADER_SIZE: int = 69

def init_block(
    header: bytes, transaction_counter: int, transactions: bytes
) -&gt; bytes:
    &quot;&quot;&quot; &quot;&quot;&quot;
    block_size = 1 + HEADER_SIZE + 1 + len(transactions)

    return (
        block_size.to_bytes(1, byteorder=&quot;big&quot;)
        + header
        + transaction_counter.to_bytes(1, byteorder=&quot;big&quot;)
        + transactions
    )</code></pre><p id="5ade277a-c1e7-4c07-9442-84389399fb85" class="">
</p><p id="bfb5b7cf-dea0-4534-85e6-f68039601acc" class="">Let&#x27;s collect what what we have so far with a function that creates the very first block, commonly referred to as the <strong>genesis block</strong>.</p><pre id="f02c294a-34d4-4bd6-b438-3abd2edc02de" class="code code-wrap"><code>def init_genesis_block() -&gt; Tuple[Hash, bytes]:
    &quot;&quot;&quot; &quot;&quot;&quot;
    previous_hash = (0).to_bytes(32, byteorder=&quot;big&quot;)
    timestamp = 1634700000
    nonce = 70822

    header = init_header(previous_hash, timestamp, nonce)
    guess = hashlib.sha256(hashlib.sha256(header).digest())
    assert guess.hexdigest()[:4] == &quot;0000&quot;

    transaction_counter, transactions = init_transactions(7000)
    block = init_block(header, transaction_counter, transactions)

    return guess.digest(), block</code></pre><p id="7cff0a57-4704-443f-8665-66b285b7a0f2" class="">
</p><p id="ce105490-3237-42bd-8fa9-fc750bd9095d" class="">Finally we have in bytes (i) the hash of the the genesis block, and (ii) the genesis block.</p><pre id="d7456ee8-30c0-4fec-94a6-db9baa42afa1" class="code code-wrap"><code>genesis_hash, genesis_block = init_genesis_block()

print(f&quot;genesis_hash:\n{prettify(genesis_hash)}\n&quot;)
print(f&quot;genesis_block:\n{prettify(genesis_block)}&quot;)</code></pre><pre id="ef7985c2-89cd-4a84-a6f2-356f7635163d" class="code code-wrap"><code>genesis_hash:
00-00-1f-f5-84-95-c3-dc-2a-1a-aa-69-eb-ca-4e-9b
3e-05-e6-3e-5a-31-9f-b7-3b-cd-cc-bc-db-ba-1e-72

genesis_block:
4b-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-61-6f-8a-e0-00-00-00-00-00-00-00-00-00-00
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
00-00-00-01-14-a6-01-00-00-1b-58</code></pre><p id="1a97b30e-f6bd-4fea-a2ca-ce0fadfeeb43" class="">
</p><p id="7f5ba6df-d70f-42a3-b65f-29539104d91d" class="">As before, let&#x27;s make clear each section with highlights.</p><figure id="b7fe7a3e-48a2-4754-a7c2-00b8aaf68fb9" class="image"><a href="1%201%20Blocks%207ac100e797924a18b1af4765b9497b5a/block_v1.jpg"><img style="width:528px" src="1%201%20Blocks%207ac100e797924a18b1af4765b9497b5a/block_v1.jpg"/></a></figure><p id="015077ad-5a53-46f9-ae1a-2e239f57a693" class="">
</p><p id="a1370cc9-34d5-4a3f-a037-bf541f7729c2" class="">We&#x27;ve simplified a lot! Let&#x27;s look at a number of things that&#x27;s different compared to the Bitcoin implementation.</p><ul id="7929e2f8-fe90-417d-afab-8673f9671e09" class="bulleted-list"><li style="list-style-type:disc">The mining difficulty is constant at two leading zero bytes. The Bitcoin implementation has a difficulty that changes so that a new block is mined, on average, every 10 minutes.</li></ul><ul id="c2e82816-8246-46dc-bbc6-7bd17b537f1a" class="bulleted-list"><li style="list-style-type:disc">The reward for mining a block is one coin. The Bitcoin implementation started at 50 coins in 2009, halves roughly every 4 years, and has a 21 million hard cap.</li></ul><p id="7fc2c918-f61a-4d3f-8f5b-b6d6ee2f43bc" class="">
</p><p id="e28c38b3-ebb3-490c-affa-964b9bfd2339" class="">In the <a href="1%202%20Chains%20564943cf92ee48c98da4e51d3789d559.html">next</a> section, we&#x27;ll be mining more blocks and &#x27;chain&#x27; them together.</p><p id="6d6717aa-6470-48f1-a556-655e3b3bb532" class="">
</p></div></article></body></html>